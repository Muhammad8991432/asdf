<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mercan — Home Goods & Lifestyle</title>
<style>
  :root{
    --bg:#f4f6f8; --card:#fff; --muted:#6b7280; --text:#0f172a;
    --accent:#0ea5a4; --accent-2:#0369a1; --glass: rgba(255,255,255,0.6);
    --shadow: 0 8px 24px rgba(15,23,42,0.08);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial;color:var(--text);background:linear-gradient(180deg,#eef2ff, var(--bg));-webkit-font-smoothing:antialiased}
  header{display:flex;align-items:center;justify-content:space-between;padding:18px 28px;background:transparent;position:sticky;top:0}
  .brand{display:flex;gap:14px;align-items:center}
  .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:white;font-weight:800;box-shadow:var(--shadow)}
  .nav{display:flex;gap:12px;align-items:center}
  .btn{padding:9px 12px;border-radius:10px;background:var(--card);box-shadow:var(--shadow);cursor:pointer;border:1px solid rgba(15,23,42,0.05);font-weight:600}
  .btn-ghost{background:transparent;border:1px solid rgba(15,23,42,0.06)}
  main{max-width:1180px;margin:22px auto;padding:18px}
  .hero{display:flex;gap:26px;align-items:flex-start}
  .hero-left{flex:1}
  .hero-right{width:420px}
  h1{margin:0;font-size:30px}
  p.lead{color:var(--muted);margin-top:8px}
  .search-bar{margin-top:16px;display:flex;gap:8px}
  input.search{flex:1;padding:12px;border-radius:12px;border:1px solid rgba(15,23,42,0.06);font-size:15px}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:22px}
  .card{background:var(--card);padding:14px;border-radius:14px;box-shadow:var(--shadow);border:1px solid rgba(15,23,42,0.04)}
  .product-img{height:160px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfdff);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--muted);font-size:14px}
  .price{font-weight:800;margin-top:8px}
  footer{margin:60px 0 30px;color:var(--muted);text-align:center}

  /* Right column: auth / profile */
  .panel{background:linear-gradient(180deg,#ffffff,var(--glass));padding:16px;border-radius:12px;box-shadow:var(--shadow);border:1px solid rgba(15,23,42,0.04)}
  label{display:block;font-size:13px;color:var(--muted);margin-top:10px}
  input[type="text"],input[type="password"]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(15,23,42,0.06);margin-top:6px;font-size:15px}
  .err{margin-top:10px;padding:10px;border-radius:8px;background:#fff3f3;border:1px solid #ffd0d0;color:#7a1b1b}
  .success{margin-top:10px;padding:10px;border-radius:8px;background:#f0fff6;border:1px solid #c8f7d2;color:#0b5d36}
  .muted-inline{color:var(--muted);font-size:13px}

  /* small responsive tweaks */
  @media (max-width:980px){
    .grid{grid-template-columns:repeat(2,1fr)}
    .hero{flex-direction:column}
    .hero-right{width:100%}
  }
  @media (max-width:560px){
    .grid{grid-template-columns:1fr}
  }

  /* little helpers */
  .top-row{display:flex;justify-content:space-between;align-items:center}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(14,165,164,0.12);color:var(--accent);font-weight:700}
  nav.top-actions{display:flex;gap:12px;align-items:center;justify-content:flex-end}
  .cart-count{background:#0b7285;color:#fff;padding:6px 8px;border-radius:8px;font-size:13px}
  .muted-note{font-size:13px;color:var(--muted);margin-top:8px}

</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo">M</div>
    <div>
      <div style="font-weight:800">Mercan</div>
      <div style="font-size:13px;color:var(--muted)">Home goods & lifestyle</div>
    </div>
  </div>
  <div class="nav">
    <button id="btn-profile" class="btn btn-ghost">Profile</button>
    <button id="btn-cart" class="btn">Cart <span id="count" class="cart-count" style="margin-left:8px">0</span></button>
  </div>
</header>

<main>
  <section class="hero">
    <div class="hero-left">
      <h1>Thoughtful everyday essentials, ready to ship</h1>
      <p class="lead">Quality materials, clean design, small-batch curation. Browse curated picks below or search to find something specific.</p>

      <div class="search-bar">
        <input id="search" class="search" placeholder="Search products, e.g. " />
        <button id="do-search" class="btn">Search</button>
      </div>

      <div class="grid" id="products">
        <!-- products injected by JS -->
      </div>
    </div>

    <div class="hero-right">
      <!-- Auth / Profile panel -->
      <div id="panel-area" class="panel">
        <!-- login form shown when not signed in -->
        <div id="login-view">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:800">Sign in</div>
            <div style="font-size:13px;color:var(--muted)">Secure for demo</div>
          </div>

          <div class="muted-note">Tip: any username will authenticate on this demo. This intentionally accepts any username (and any password) to let you try different inputs. The welcome message intentionally reflects your username without sanitization for testing XSS in a safe lab.</div>

          <label for="username">Username</label>
          <input id="username" type="text" autocomplete="off" placeholder="your.username" />

          <label for="password">Password</label>
          <input id="password" type="password" autocomplete="off" placeholder="password (any)" />

          <button id="login-btn" class="btn" style="margin-top:12px;width:100%;">Sign in</button>

          <div id="msg" aria-live="polite"></div>

          <div style="margin-top:12px;font-size:13px;color:var(--muted)">This demo stores session in <code>localStorage</code> only and does not contact any server.</div>
        </div>

        <!-- profile shown when signed in -->
        <div id="profile-view" style="display:none">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:800">Your profile</div>
            <div style="font-size:13px;color:var(--muted)">Member</div>
          </div>

          <!-- IMPORTANT: welcomeName receives innerHTML directly (intentional vulnerability). -->
          <div style="margin-top:12px;font-size:15px">Hello, <span id="welcomeName"></span></div>
          <div class="muted-note">Email: <span id="fakeEmail" class="muted-inline">(demo-no-email)</span></div>

          <div style="margin-top:12px;display:flex;gap:8px">
            <button id="btn-orders" class="btn btn-ghost">Orders</button>
            <button id="btn-logout" class="btn">Sign out</button>
          </div>
        </div>
      </div>

      <!-- quick cart preview -->
      <div style="height:14px"></div>
      <div class="panel" style="margin-top:14px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:700">Quick cart</div>
          <div class="muted-inline">Ready to checkout</div>
        </div>
        <div id="cart-list" style="margin-top:12px">No items yet.</div>
        <div style="margin-top:12px">
          <button id="checkout" class="btn" style="width:100%">Checkout (demo)</button>
        </div>
      </div>

    </div>
  </section>

  <footer>
    © <span id="year"></span> Mercan • Demo environment — do not deploy publicly
  </footer>
</main>

<script>
  // ========== Product data (static) ==========
  const PRODUCTS = [
    {id:1,name:'Ultra Backpack',desc:'14L • water-resistant, padded laptop sleeve',price:49},
    {id:2,name:'Everyday Watch',desc:'Minimal design • 3 ATM',price:79},
    {id:3,name:'Commuter Mug',desc:'Stainless, insulated • 12oz',price:19},
    {id:4,name:'Knit Throw',desc:'Soft acrylic • 50x60 in',price:39},
    {id:5,name:'Desk Lamp',desc:'Adjustable arm • warm LED',price:59},
    {id:6,name:'Travel Pouch',desc:'Cord organizer • multiple pockets',price:14}
  ];

  // ========== Basic app state ==========
  const state = {
    user: null, // {username}
    cart: [] // array of product ids
  };

  // DOM refs
  const productsEl = document.getElementById('products');
  const countEl = document.getElementById('count');
  const cartList = document.getElementById('cart-list');

  const loginBtn = document.getElementById('login-btn');
  const usernameInput = document.getElementById('username');
  const passwordInput = document.getElementById('password');
  const msg = document.getElementById('msg');
  const panelArea = document.getElementById('panel-area');

  const loginView = document.getElementById('login-view');
  const profileView = document.getElementById('profile-view');
  const welcomeName = document.getElementById('welcomeName');
  const fakeEmail = document.getElementById('fakeEmail');

  const btnLogout = document.getElementById('btn-logout');
  const btnOrders = document.getElementById('btn-orders');

  // ========== Utilities ==========
  function $(sel){return document.querySelector(sel)}
  function saveState(){
    localStorage.setItem('merc_demo', JSON.stringify({user:state.user,cart:state.cart}));
  }
  function loadState(){
    try{
      const s = JSON.parse(localStorage.getItem('merc_demo'));
      if(s){ state.user = s.user || null; state.cart = s.cart || []; }
    }catch(e){ /* ignore */ }
  }

  // ========== Render ==========
  function renderProducts(list){
    productsEl.innerHTML = '';
    list.forEach(p=>{
      const card = document.createElement('article'); card.className='card';
      card.innerHTML = `
        <div class="product-img">${p.name}</div>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:700">${p.name}</div>
            <div class="muted-inline">${p.desc}</div>
          </div>
          <div style="text-align:right">
            <div class="price">$${p.price}</div>
            <button data-id="${p.id}" class="btn" style="margin-top:8px">Add</button>
          </div>
        </div>
      `;
      productsEl.appendChild(card);
    });
  }

  function renderCart(){
    if(state.cart.length===0){ cartList.innerHTML='No items yet.'; countEl.textContent='0'; return; }
    const lines = state.cart.map(id=>{
      const p = PRODUCTS.find(x=>x.id===id);
      return `<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px"><div><div style=\"font-weight:700\">${p.name}</div><div class=\"muted-inline\">Qty 1</div></div><div class=\"price\">$${p.price}</div></div>`
    });
    cartList.innerHTML = lines.join('');
    countEl.textContent = String(state.cart.length);
  }

  function setSignedIn(user){
    state.user = {username: user};
    saveState();
    updateUIForAuth();
  }

  function signOut(){
    state.user = null; state.cart = []; localStorage.removeItem('merc_demo'); updateUIForAuth(); renderCart();
  }

  function updateUIForAuth(){
    if(state.user){
      loginView.style.display='none';
      profileView.style.display='block';
      // IMPORTANT: intentionally vulnerable: using innerHTML with unescaped username
      // so testers can try XSS payloads in the username on this demo page.
      welcomeName.innerHTML = state.user.username;
      fakeEmail.textContent = state.user.username.replace(/\s+/g,'.') + '@example.local';
      msg.innerHTML = '<div class="success">Signed in as '+ escapeHtml(state.user.username) +'</div>';
    } else {
      loginView.style.display='block';
      profileView.style.display='none';
      msg.innerHTML = '';
      usernameInput.value=''; passwordInput.value='';
    }
  }

  // escapeHtml used only for non-vulnerable text in messages; not used for welcomeName deliberately.
  function escapeHtml(s){
    return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
  }

  // ========== Events ==========
  document.addEventListener('click', (e)=>{
    if(e.target && e.target.getAttribute && e.target.getAttribute('data-id')){
      const id = Number(e.target.getAttribute('data-id'));
      state.cart.push(id);
      saveState();
      renderCart();
      e.target.textContent = 'Added';
      setTimeout(()=>{ e.target.textContent = 'Add'; },900);
    }
  });

  document.getElementById('do-search').addEventListener('click', ()=>{
    const q = document.getElementById('search').value.trim().toLowerCase();
    if(!q){ renderProducts(PRODUCTS); return; }
    const filtered = PRODUCTS.filter(p=> (p.name+ ' ' + p.desc).toLowerCase().includes(q));
    renderProducts(filtered);
  });

  // Login: per user request, ANY username should authenticate. Password is not validated.
  loginBtn.addEventListener('click', ()=>{
    const u = usernameInput.value || '';
    const p = passwordInput.value || '';
    if(!u){ msg.innerHTML = '<div class="err">Please enter a username.</div>'; return; }

    // Accept any username — set session and show profile.
    setSignedIn(u);
  });

  btnLogout.addEventListener('click', ()=>{ signOut(); });
  document.getElementById('btn-profile').addEventListener('click', ()=>{ window.scrollTo({top:0,behavior:'smooth'}); usernameInput.focus(); });
  document.getElementById('btn-cart').addEventListener('click', ()=>{ window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'}); });

  document.getElementById('checkout').addEventListener('click', ()=>{
    if(!state.user){ msg.innerHTML = '<div class="err">Sign in before checkout.</div>'; return; }
    alert('This is a demo checkout. No payment is processed.');
  });

  btnOrders.addEventListener('click', ()=>{ alert('No real orders in demo — try adding items to cart and checkout.'); });

  // ========== Init ==========
  function init(){
    loadState();
    renderProducts(PRODUCTS);
    renderCart();
    updateUIForAuth();
    document.getElementById('year').textContent = new Date().getFullYear();

    // Allow Enter key to login
    [usernameInput,passwordInput].forEach(el=>el.addEventListener('keyup',(e)=>{ if(e.key==='Enter') loginBtn.click(); }));
  }

  init();

  // Helpful console message
  console.log('Mercan demo v2 loaded. This page intentionally reflects the raw username into the profile welcome (innerHTML) to demonstrate reflected XSS in a safe, local environment. Do not deploy publicly.');
</script>
</body>
</html>
